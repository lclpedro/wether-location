version: "3.1"
services:
    zipkin:
        image: openzipkin/zipkin
        ports:
        - "9411:9411"
            
    otel-collector:
        image: otel/opentelemetry-collector:latest
        restart: always
        command: ["--config", "/etc/otel-collector-config.yaml"]
        volumes:
            - ./.docker/otel-collector-config.yaml:/etc/otel-collector-config.yaml
        ports:
            - "8888:8888"
            - "8889:8889"
            - "4317:4317"
    app:
        build:
            context: .
        volumes:
          - .:/app
        ports:
            - "8080:8080"
        environment:
            WEATHER_API_TOKEN: $WEATHER_API_TOKEN
        dns:
            - 8.8.8.8
        depends_on:
            - zipkin
            - otel-collector